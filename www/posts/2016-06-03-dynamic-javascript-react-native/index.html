<!doctype html><html lang="en"><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><meta name="viewport" content="width=device-width, initial-scale=1" /><link rel="stylesheet" href="/phenomic.browser.6c72124e9719e82430f9.css" /><meta data-react-helmet="true" name="generator" content="Phenomic 0.16.2"/><meta data-react-helmet="true" property="og:site_name" content="blog-phenomic"/><meta data-react-helmet="true" name="twitter:site" content="@ralex1993"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:title" content="Dynamically Updating Javascript Resources for React Native if you don’t know what you are doing with Objective-C"/><meta data-react-helmet="true" property="og:url" content="http://ralexanderson.com/posts/2016-06-03-dynamic-javascript-react-native/"/><meta data-react-helmet="true" property="og:description" content="For a project at work, I’m creating a React Native app. The nice thing about React Native is you can load the javascript bundle (the brains…"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="Dynamically Updating Javascript Resources for React Native if you don’t know what you are doing with Objective-C"/><meta data-react-helmet="true" name="twitter:creator" content="@ralex1993"/><meta data-react-helmet="true" name="twitter:description" content="For a project at work, I’m creating a React Native app. The nice thing about React Native is you can load the javascript bundle (the brains…"/><meta data-react-helmet="true" name="description" content="For a project at work, I’m creating a React Native app. The nice thing about React Native is you can load the javascript bundle (the brains…"/><title data-react-helmet="true">Dynamically Updating Javascript Resources for React Native if you don’t know what you are doing with Objective-C</title></head><body><div id="phenomic"><div class="BQq3Y" data-reactroot="" data-reactid="1" data-react-checksum="1546912640"><!-- react-empty: 2 --><!-- react-empty: 3 --><style data-reactid="4">@-ms-viewport { width: device-width; }</style><header class="_1xV8A" data-reactid="5"><nav class="_1G2C6" data-reactid="6"><div class="_3ScMt" data-reactid="7"><a class="_2Dqnn" href="/" data-reactid="8">About</a><a class="_2Dqnn" href="/posts" data-reactid="9">Blog</a><a class="_2Dqnn" href="/resume" data-reactid="10">Resumé</a></div></nav></header><div class="_1jOjL" data-reactid="11"><div data-reactid="12"><div class="_1dFzo" data-reactid="13"><div data-reactid="14"><!-- react-empty: 15 --><h1 data-reactid="16">Dynamically Updating Javascript Resources for React Native if you don’t know what you are doing with Objective-C</h1><header data-reactid="17"><time data-reactid="18">Thu Jun 02 2016</time></header><div data-reactid="19"><div class="phenomic-BodyContainer" data-reactid="20"><p>For a project at work, I’m creating a React Native app. The nice thing about React Native is you can load the javascript bundle (the brains of the app, so to speak) from a remote server. This means that you can make updates and changes without having to go through the App Store approval process.</p>
<p>The downside to this is that it takes a second or two to load the bundle before the app itself actually loads. Unless you have some fancy Objective-C or Swift ‘Loading’ animation, it’s just going to show a white screen. I don’t have any experience with iOS programming, so I decided to do the next best thing — load the bundle from the device locally.
I was able to piece together most of what to do from this guide, but some of it I had to figure out on my own.</p>
<p><a href="https://medium.com/ios-os-x-development/so-you-want-to-dynamically-update-your-react-native-app-d1d88bf11ede#.qzg6q5n3o">So You Want To Dynamically Update Your React Native App</a></p>
<p>At work we recently shipped our first React Native components inside an app, and I’ve been mulling how (and if…medium.com
React Native gives you the option to have the JS bundle stored in the application bundle, which gives you almost instant load times. I could use that mechanism to do what I wanted.</p>
<p>First, I needed to check to see if there was a downloaded JS bundle or if I needed to use the app’s bundle:</p>
<pre><code>//This is the document directory of the app itself.
NSString *documentDir = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) firstObject];
//filePath represents where the downloaded bundle resides. It's in the documents directory of the app.
NSString *filePath = [documentDir stringByAppendingPathComponent:@”main-loaded.jsbundle”];
NSURL *codeLocation = [NSURL URLWithString:filePath];

//use the application bundle if there is no file in the execution path
if (![[NSFileManager defaultManager] fileExistsAtPath:filePath]) {
//Load the app bundle's javascript
jsCodeLocation = [[NSBundle mainBundle] URLForResource:@”main” withExtension:@”jsbundle”];
NSLog(@”Loaded from application bundle”);
} else {
//Load the downloaded Javascript bundle.
jsCodeLocation = codeLocation;
NSLog(@”Loaded from remote bundle”);
}
</code></pre>
<p>If you just throw this into your AppDelegate.m file, it will load the application bundle every time, since it isn’t downloading anything to the documents folder.</p>
<p>Next I asynchronously load the Javascript bundle from the remote server (in my case, I use Amazon S3 to host it)</p>
<pre><code>remoteCode = [NSURL URLWithString:@”https://***path to your javascript bundle***"];
//Make the request asynchronously
NSURLRequest *request = [NSURLRequest requestWithURL:remoteCode];
[NSURLConnection sendAsynchronousRequest:request queue:[NSOperationQueue currentQueue] completionHandler:^(NSURLResponse *response, NSData *data, NSError *error) {
if (error) {
NSLog(@”Download Error:%@”,error.description);
}
if (data) {
//Save the data to the file path
[data writeToFile:filePath atomically:YES];
NSLog(@”File is saved to %@”,filePath);
}
}];
</code></pre>
<p>This is going to download the bundle and save it to the file path, but only after the application has already loaded.</p>
<p>Finally, use the boilerplate React Native code to insert the React Native view into the Objective-C app.</p>
<pre><code>RCTRootView *rootView = [[RCTRootView alloc] initWithBundleURL:jsCodeLocation
moduleName:@”***Name of your module***”
initialProperties:nil
launchOptions:launchOptions];
</code></pre>
<p>Now, whenever your app loads, it will use the downloaded version of your Javascript bundle.</p>
</div></div></div></div></div></div></div></div><script>window.__COLLECTION__ = [{"title":"R. Alex Anderson","layout":"Homepage","description":"R. Alex Anderson is a 23 year old college student living in Provo, Utah. He enjoys creating, sharing, exploring, teaching and learning. He…","__filename":"index.md","__url":"/","__resourceUrl":"/index.html","__dataUrl":"/index.html.6df77ad581e30cf1bc55920893d3d040.json"},{"layout":"PageLoading","description":"Content here not used, see web_modules/layouts/PageLoading. This page is a demo for loading state. You can safely delete if you want.","__filename":"loading.md","__url":"/loading/","__resourceUrl":"/loading/index.html","__dataUrl":"/loading/index.html.4f959959ceecdafbb30e2e8fd2869cdc.json"},{"layout":"PageError","route":"404.html","description":"Content here not used, see web_modules/layouts/PageError","__filename":"404.md","__url":"/404.html","__resourceUrl":"/404.html","__dataUrl":"/404.html.f3d82a4d938b593823c37ead979b3b86.json"},{"title":"Funtimes with Elixir and Phoenix","date":"2016-06-20T00:00:00.000Z","layout":"Post","description":"I’m starting to learn Elixir with the Phoenix Framework. This project has a pretty intense stack. I don’t know a whole lot about all of the…","__filename":"posts/2016-06-20-funtimes-with-elixir-and-phoenix.md","__url":"/posts/2016-06-20-funtimes-with-elixir-and-phoenix/","__resourceUrl":"/posts/2016-06-20-funtimes-with-elixir-and-phoenix/index.html","__dataUrl":"/posts/2016-06-20-funtimes-with-elixir-and-phoenix/index.html.22765c0b49e13d7584baf26262199a13.json"},{"title":"Dynamically Updating Javascript Resources for React Native if you don’t know what you are doing with Objective-C","date":"2016-06-03T00:00:00.000Z","layout":"Post","description":"For a project at work, I’m creating a React Native app. The nice thing about React Native is you can load the javascript bundle (the brains…","__filename":"posts/2016-06-03-dynamic-javascript-react-native.md","__url":"/posts/2016-06-03-dynamic-javascript-react-native/","__resourceUrl":"/posts/2016-06-03-dynamic-javascript-react-native/index.html","__dataUrl":"/posts/2016-06-03-dynamic-javascript-react-native/index.html.2e2b7ff0ec25d1077bf6a7bef51ebbc3.json"},{"title":"Why I prefer Elixir/Phoenix to Meteor","date":"2016-06-22T00:00:00.000Z","layout":"Post","description":"Build times are much faster. I’m a ‘code it, save it, check it’ kind of programmer, programming features bit by bit rather than all at…","__filename":"posts/2016-06-22-why-i-prefer-elixir-to-meteor.md","__url":"/posts/2016-06-22-why-i-prefer-elixir-to-meteor/","__resourceUrl":"/posts/2016-06-22-why-i-prefer-elixir-to-meteor/index.html","__dataUrl":"/posts/2016-06-22-why-i-prefer-elixir-to-meteor/index.html.b4bfa367a96ab110748a435b8fb1acea.json"},{"title":"R. Alex Anderson - Blog","date":"2016-02-14T00:00:00.000Z","layout":"PostIndex","description":"","__filename":"posts/index.md","__url":"/posts/","__resourceUrl":"/posts/index.html","__dataUrl":"/posts/index.html.954ee9c97f109cf6f0ed47f7de10cc81.json"},{"title":"R. Alex Anderson","description":"--- > #### Programmer > #####  Provo, UT &emsp; [ralexanderson.com][homepage] &emsp; [@ralex1993][twitter] > `Javascript`, `Meteor`,…","__filename":"resume.md","__url":"/resume/","__resourceUrl":"/resume/index.html","__dataUrl":"/resume/index.html.10abeed7fb38d3220ffec8abfca894de.json"},{"layout":"Social","title":"Cash.me","icon":"usd","link":"http://Cash.me/$alexanderson1993","description":"","__filename":"social/cash.md","__url":"/social/cash/","__resourceUrl":"/social/cash/index.html","__dataUrl":"/social/cash/index.html.5b21e87973d92adcad15c5bdbbe6b110.json"},{"layout":"Social","title":"Facebook","icon":"facebook","link":"http://www.facebook.com/alexanderson1993","description":"","__filename":"social/facebook.md","__url":"/social/facebook/","__resourceUrl":"/social/facebook/index.html","__dataUrl":"/social/facebook/index.html.09262c39df5e2b4b4692fc0ca1d71e5e.json"},{"layout":"Social","title":"Github","icon":"github","link":"https://github.com/alexanderson1993","description":"","__filename":"social/github.md","__url":"/social/github/","__resourceUrl":"/social/github/index.html","__dataUrl":"/social/github/index.html.0781085b9ff11b24f9c6ece1783adc6e.json"},{"layout":"Social","title":"Keybase","icon":"key","link":"http://keybase.io/alexanderson1993","description":"","__filename":"social/keybase.md","__url":"/social/keybase/","__resourceUrl":"/social/keybase/index.html","__dataUrl":"/social/keybase/index.html.206c78561cf52f0b15a229991779d90b.json"},{"layout":"Social","title":"Instagram","icon":"instagram","link":"https://instagram.com/alexanderson1993","description":"","__filename":"social/instagram.md","__url":"/social/instagram/","__resourceUrl":"/social/instagram/index.html","__dataUrl":"/social/instagram/index.html.170e9994190115db6f9414b3896c3516.json"},{"layout":"Social","title":"Medium","icon":"medium","link":"https://medium.com/@alexanderson1993","description":"","__filename":"social/medium.md","__url":"/social/medium/","__resourceUrl":"/social/medium/index.html","__dataUrl":"/social/medium/index.html.0305f42fc27e25b9c6373bf1bf41924b.json"},{"layout":"Social","title":"Mormon.org","icon":"smile-o","link":"http://mormon.org/me/824W","description":"","__filename":"social/mormon.md","__url":"/social/mormon/","__resourceUrl":"/social/mormon/index.html","__dataUrl":"/social/mormon/index.html.a04f35bf1fff641f5932bf3062514ace.json"},{"layout":"Social","title":"Snapchat","icon":"snapchat","link":"https://www.snapchat.com/add/ralex1993","description":"","__filename":"social/snapchat.md","__url":"/social/snapchat/","__resourceUrl":"/social/snapchat/index.html","__dataUrl":"/social/snapchat/index.html.495d0028270a7584a6914ef142fe6a81.json"},{"layout":"Social","title":"Twitter","icon":"twitter","link":"http://www.twitter.com/ralex1993","description":"","__filename":"social/twitter.md","__url":"/social/twitter/","__resourceUrl":"/social/twitter/index.html","__dataUrl":"/social/twitter/index.html.dca6648e09b22c659c07db3851079750.json"}];window.__INITIAL_STATE__ = {"pages":{"/posts/2016-06-03-dynamic-javascript-react-native/":{"head":{"title":"Dynamically Updating Javascript Resources for React Native if you don’t know what you are doing with Objective-C","date":"2016-06-03T00:00:00.000Z","layout":"Post","description":"For a project at work, I’m creating a React Native app. The nice thing about React Native is you can load the javascript bundle (the brains…"},"body":"<p>For a project at work, I’m creating a React Native app. The nice thing about React Native is you can load the javascript bundle (the brains of the app, so to speak) from a remote server. This means that you can make updates and changes without having to go through the App Store approval process.</p>\n<p>The downside to this is that it takes a second or two to load the bundle before the app itself actually loads. Unless you have some fancy Objective-C or Swift ‘Loading’ animation, it’s just going to show a white screen. I don’t have any experience with iOS programming, so I decided to do the next best thing — load the bundle from the device locally.\nI was able to piece together most of what to do from this guide, but some of it I had to figure out on my own.</p>\n<p><a href=\"https://medium.com/ios-os-x-development/so-you-want-to-dynamically-update-your-react-native-app-d1d88bf11ede#.qzg6q5n3o\">So You Want To Dynamically Update Your React Native App</a></p>\n<p>At work we recently shipped our first React Native components inside an app, and I’ve been mulling how (and if…medium.com\nReact Native gives you the option to have the JS bundle stored in the application bundle, which gives you almost instant load times. I could use that mechanism to do what I wanted.</p>\n<p>First, I needed to check to see if there was a downloaded JS bundle or if I needed to use the app’s bundle:</p>\n<pre><code>//This is the document directory of the app itself.\nNSString *documentDir = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) firstObject];\n//filePath represents where the downloaded bundle resides. It's in the documents directory of the app.\nNSString *filePath = [documentDir stringByAppendingPathComponent:@”main-loaded.jsbundle”];\nNSURL *codeLocation = [NSURL URLWithString:filePath];\n\n//use the application bundle if there is no file in the execution path\nif (![[NSFileManager defaultManager] fileExistsAtPath:filePath]) {\n//Load the app bundle's javascript\njsCodeLocation = [[NSBundle mainBundle] URLForResource:@”main” withExtension:@”jsbundle”];\nNSLog(@”Loaded from application bundle”);\n} else {\n//Load the downloaded Javascript bundle.\njsCodeLocation = codeLocation;\nNSLog(@”Loaded from remote bundle”);\n}\n</code></pre>\n<p>If you just throw this into your AppDelegate.m file, it will load the application bundle every time, since it isn’t downloading anything to the documents folder.</p>\n<p>Next I asynchronously load the Javascript bundle from the remote server (in my case, I use Amazon S3 to host it)</p>\n<pre><code>remoteCode = [NSURL URLWithString:@”https://***path to your javascript bundle***\"];\n//Make the request asynchronously\nNSURLRequest *request = [NSURLRequest requestWithURL:remoteCode];\n[NSURLConnection sendAsynchronousRequest:request queue:[NSOperationQueue currentQueue] completionHandler:^(NSURLResponse *response, NSData *data, NSError *error) {\nif (error) {\nNSLog(@”Download Error:%@”,error.description);\n}\nif (data) {\n//Save the data to the file path\n[data writeToFile:filePath atomically:YES];\nNSLog(@”File is saved to %@”,filePath);\n}\n}];\n</code></pre>\n<p>This is going to download the bundle and save it to the file path, but only after the application has already loaded.</p>\n<p>Finally, use the boilerplate React Native code to insert the React Native view into the Objective-C app.</p>\n<pre><code>RCTRootView *rootView = [[RCTRootView alloc] initWithBundleURL:jsCodeLocation\nmoduleName:@”***Name of your module***”\ninitialProperties:nil\nlaunchOptions:launchOptions];\n</code></pre>\n<p>Now, whenever your app loads, it will use the downloaded version of your Javascript bundle.</p>\n","__filename":"posts/2016-06-03-dynamic-javascript-react-native.md","__url":"/posts/2016-06-03-dynamic-javascript-react-native/","__resourceUrl":"/posts/2016-06-03-dynamic-javascript-react-native/index.html","__dataUrl":"/posts/2016-06-03-dynamic-javascript-react-native/index.html.2e2b7ff0ec25d1077bf6a7bef51ebbc3.json","type":"Post"}}}</script><script data-react-helmet="true" src="https://cdn.polyfill.io/v2/polyfill.min.js"></script><script src="/phenomic.browser.6c72124e9719e82430f9.js"></script></body></html>